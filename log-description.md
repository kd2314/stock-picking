# 股票分析系统 - 统一日志系统

## 概述

本项目已完成日志系统的统一规范化，所有模块的日志现在都会写入当日的统一日志文件中。

## 日志文件命名规则

- 日志文件按日期命名：`YYYY-MM-DD.log`
- 所有当日产生的日志都写入同一个文件
- 例如：`2025-07-22.log` 包含2025年7月22日的所有日志

## 日志文件位置

```
log/
├── 2025-07-22.log          # 今日统一日志
├── 2025-07-21.log          # 昨日日志
└── ...                     # 历史日志文件
```

## 日志格式

```
YYYY-MM-DD HH:MM:SS - 模块名 - 日志级别 - 日志内容
```

例如：
```
2025-07-22 16:11:53 - stock_analysis - INFO - 获取到股票数量: 300
2025-07-22 16:11:53 - flask_app - INFO - API请求: /api/signals 参数: {'signal_type': '底钝化'} 返回结果: 15条
2025-07-22 16:11:53 - system - INFO - 系统启动完成
```

## 模块分类

### 主要日志模块

1. **stock_analysis** - 股票分析相关日志
   - 股票数据获取
   - 信号计算处理
   - 批次处理进度

2. **flask_app** - Web应用相关日志
   - API请求记录
   - 数据保存操作
   - 系统启动信息

3. **system** - 系统级日志
   - 配置信息
   - 统计数据
   - 错误处理

4. **api** - API专用日志
   - 请求参数记录
   - 返回结果统计

## 如何使用日志系统

### 在新模块中使用

```python
from logger_config import get_unified_logger, log_stock_analysis, log_api_request

# 获取通用日志器
logger = get_unified_logger('your_module_name')
logger.info("这是一条信息日志")
logger.warning("这是一条警告日志")
logger.error("这是一条错误日志")

# 使用专用日志函数
log_stock_analysis("股票分析相关信息")
log_api_request("/api/endpoint", {"param": "value"}, 100)
```

### 日志级别

- **INFO** - 一般信息，正常操作记录
- **WARNING** - 警告信息，不影响功能但需关注
- **ERROR** - 错误信息，功能异常或失败
- **DEBUG** - 调试信息（默认不显示）

## 日志管理功能

### 自动清理旧日志

系统会自动清理30天以前的日志文件，避免占用过多磁盘空间。

### 实时输出

所有日志既会写入文件，也会在控制台实时显示，方便开发调试。

## 相比旧系统的改进

### 之前的问题
- 每次运行创建新的日志文件（带时间戳）
- 日志分散在多个文件中
- Flask应用使用print语句，没有统一管理
- 缺少日志分类和格式规范

### 现在的优势
- ✅ 当日所有日志统一到一个文件
- ✅ 标准化的日志格式和分类
- ✅ 统一的日志接口和配置
- ✅ 自动清理旧日志文件
- ✅ 同时支持文件和控制台输出
- ✅ 模块化的日志函数

## 文件结构

```
项目根目录/
├── logger_config.py        # 统一日志配置模块
├── app.py                  # Flask应用（已更新）
├── stock_signals.py        # 股票分析模块（已更新）
├── log/
│   ├── 2025-07-22.log     # 今日统一日志
│   └── ...                # 历史日志
└── 日志系统说明.md         # 本说明文档
```

## 注意事项

1. 确保在项目中导入 `logger_config` 模块
2. 使用统一的日志函数，避免直接使用 `print` 语句
3. 根据日志内容选择合适的模块名和日志级别
4. 日志会自动按日期轮转，无需手动管理文件名 